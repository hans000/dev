var e,t,a=Object.defineProperty,n=Object.defineProperties,i=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,c=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,o=(e,t,n)=>t in e?a(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,s=(e,t)=>{for(var a in t||(t={}))c.call(t,a)&&o(e,a,t[a]);if(l)for(var a of l(t))r.call(t,a)&&o(e,a,t[a]);return e},d=(e,t)=>n(e,i(t));function p(e){return e&&"string"==typeof e?e.startsWith("minecraft:")?e.slice(10):e:"error"}function u(e){return"minecraft:"+e}function m(e){return fetch(e).then((e=>e.json()))}(t=e||(e={}))[t.CraftShaped=0]="CraftShaped",t[t.CraftShapeless=1]="CraftShapeless",t[t.StoneCutting=2]="StoneCutting",t[t.Smithing=3]="Smithing",t[t.Other=4]="Other";const g={crafting_shaped:{name:"有序合成",type:0,icon:"crafting_table",disabled:[]},crafting_shapeless:{name:"无序合成",type:1,icon:"crafting_table",disabled:[]},smelting:{name:"熔炉",type:4,icon:"furnace",disabled:[]},stonecutting:{name:"切石机",type:2,icon:"stonecutter",disabled:["1.13"]},smithing:{name:"锻造台",type:3,icon:"smithing_table",disabled:["1.13"]},blasting:{name:"高炉",type:4,icon:"blast_furnace",disabled:["1.13"]},campfire_cooking:{name:"营火",type:4,icon:"campfire",disabled:["1.13"]},smoking:{name:"烟熏炉",type:4,icon:"smoker",disabled:["1.13"]}};function f(e){return"crafting_shapeless"===e?1:"crafting_shaped"===e?0:"stonecutting"===e?2:"smithing"===e?3:4}var h,R=(e,t,a)=>{if(!t.has(e))throw TypeError("Cannot "+a)},y=(e,t,a)=>(R(e,t,"read from private field"),a?a.call(e):t.get(e));function v(e){return{item:(Array.isArray(e)?e:[e]).map(p)}}function E(e){return v(function(e){return(Array.isArray(e)?e:[e]).map((e=>u(p(e.item))))}(e))}const C=class{constructor(){((e,t,a)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,a)})(this,h,C.getDefaultValue())}static convertByPattern(e){return e.pattern.join("").split("").reduce(((t,a)=>" "===a?(t.push(void 0),t):(t.push(E(e.key[a])),t)),[])}static getDefaultValue(){return{type:"crafting_shaped",ingredients:[],result:void 0,group:""}}static getKeyPattern(e){const t={},a={};let n=0;const i=[];let l="";for(Array.from({length:9},(()=>"")).forEach(((c,r)=>{const o=e[r];if(o){const e=o.item.join("-"),i=t[e];let c="";void 0===i?(t[e]=n,c=C.Keys[n++],a[c]=o.item.length>1?o.item.map((e=>({item:u(e)}))):{item:u(o.item[0])}):c=C.Keys[i],l+=c}else l+=" ";r%3==2&&(i.push(l),l="")}));i.length;){if(i[i.length-1].trim())break;i.pop()}return{key:a,pattern:i}}get data(){const e=y(this,h),{ingredients:t,result:a}=e,n=((e,t)=>{var a={};for(var n in e)c.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&l)for(var n of l(e))t.indexOf(n)<0&&r.call(e,n)&&(a[n]=e[n]);return a})(e,["ingredients","result"]);return d(s({},n),{input:t.map((e=>e?{id:e.item}:void 0)),output:a?{id:a.item?[a.item]:[],count:a.count}:{}})}reset(){var e,t,a,n;e=this,t=h,a=C.getDefaultValue(),R(e,t,"write to private field"),n?n.call(e,a):t.set(e,a)}import(e){this.reset();const{group:t,experience:a,cookingtime:n}=e,i=p(e.type);let l,c,r;l="crafting_shaped"===i?C.convertByPattern(e):"crafting_shapeless"===i?e.ingredients.map((e=>E(e))):"smithing"===i?[v(e.base.item),v(e.addition.item)]:[E(e.ingredient)],"string"==typeof e.result?(c=p(e.result),r=e.count||1):(c=p(e.result.item),r=e.result.count),this.setProps({type:i,group:t,experience:a,cookingtime:n,ingredients:l,result:{item:c,count:r}})}getProps(e){return y(this,h)[e]}setProps(e){Object.keys(e).forEach((t=>{y(this,h)[t]=e[t]}))}toJson(){const{ingredients:t,result:a,cookingtime:n,experience:i,group:l}=y(this,h),c=f(y(this,h).type),r=u(y(this,h).type);if(c===e.CraftShaped){const{pattern:e,key:n}=C.getKeyPattern(t),i={type:r,key:n,pattern:e,result:a};return l?d(s({},i),{group:l}):i}if(c===e.CraftShapeless){const e={type:r,result:a,ingredients:t.map((e=>e.item.map((e=>({item:e})))))};return l?d(s({},e),{group:l}):e}if(c===e.StoneCutting){const e={type:r,count:a.count,result:a.item,ingredient:t.map((e=>({item:e.item[0]})))};return l?d(s({},e),{group:l}):e}if(c===e.Smithing){const[e,n]=t.map((e=>({item:e.item[0]}))),i={type:r,base:e,addition:n,result:{item:null==a?void 0:a.item,count:null==a?void 0:a.count}};return l?d(s({},i),{group:l}):i}const o={type:r,cookingtime:n,experience:i,result:null==a?void 0:a.item,ingredient:t.map((e=>({item:e.item[0]})))};return l?d(s({},o),{group:l}):o}};let k=C;h=new WeakMap,k.Keys=["#","$","*","%","&","|","!","+","-"];const b={versionList:["1.13","1.14","1.15","1.16","1.17","1.18","1.19"],version:"1.19",loading:!1,lang:{},tagZip:null,recipeZip:null},w=React.createContext([null,null]);function S(e,t){switch(t.type){case"UpdateVersion":return d(s({},e),{version:t.payload});case"UpdateLoading":return d(s({},e),{loading:t.payload});case"UpdateLang":return d(s({},e),{lang:t.payload});case"UpdateTagZip":return d(s({},e),{tagZip:t.payload});case"UpdateRecipeZip":return d(s({},e),{recipeZip:t.payload});default:return e}}function O(e){var t,a,n,i;const[l]=React.useContext(w),c=React.useMemo((()=>{var t,a;return(null==(a=null==(t=null==e?void 0:e.data)?void 0:t.id)?void 0:a.length)?e.data.id:[]}),[e.data]);const r=React.useMemo((()=>c.length?(e.offset+1)%c.length:0),[e.offset]),o=React.useMemo((()=>{const e=l.version.split(".")[1],t=c[r],a="error"!==t&&l.lang[t]?`${t}-${e}`:"error";return t?`icon-${e} ${a}`:"undefined"}),[c,l.version,r,l.lang]),s=React.useMemo((()=>{const e=c[r];return"error"===e?"":l.lang[e]+"-"+e}),[c,r,l.lang]);return React.createElement("div",{className:"tile",onClick:null==(t=null==e?void 0:e.onClick)?void 0:t.bind(null,e.data)},React.createElement("i",{title:s,style:{display:"inline-block"},className:o},e.showCount&&(null==(a=e.data)?void 0:a.count)?React.createElement("span",null,e.data.count):null,(null==(i=null==(n=e.data)?void 0:n.id)?void 0:i.length)?React.createElement(icons.CloseCircleOutlined,{onClick:function(t){t.stopPropagation(),null==e||e.onClear(e.data)},className:"close"}):null))}function x(e){return React.createElement("div",{className:"grid",style:{width:42*e.cols}},Array.from({length:e.cols*e.rows}).map(((t,a)=>{const n=e.data[a];return React.createElement(O,{key:a,data:n,offset:e.offset,onClear:e.onClear&&e.onClear.bind(null,n,a),onClick:e.onClick&&e.onClick.bind(null,n,a)})})))}function P(e){return React.createElement("div",{className:"smithing"},React.createElement(O,{offset:e.offset,data:e.data[0],onClick:e.onClick&&e.onClick.bind(null,e.data[0],0)}),React.createElement("div",{className:"smithing-add"}),React.createElement(O,{offset:e.offset,data:e.data[1],onClick:e.onClick&&e.onClick.bind(null,e.data[1],1)}))}function N(e){const[t,a]=React.useState(0);return React.useEffect((()=>{let e;return e=window.setInterval((()=>{a((e=>e+1))}),1e3),()=>clearInterval(e)}),[]),React.createElement("div",{className:"craft"},React.createElement("div",{className:"input"},"crafting_shaped"===e.data.type||"crafting_shapeless"===e.data.type?React.createElement(x,{rows:3,cols:3,offset:t,data:e.data.input,onClick:e.onClick,onClear:e.onClear}):"smithing"===e.data.type?React.createElement(P,{offset:t,data:e.data.input,onClear:e.onClear,onClick:e.onClick}):React.createElement(O,{offset:t,data:e.data.input[0],onClear:e.onClear&&e.onClear.bind(null,e.data.input[0],0),onClick:e.onClick&&e.onClick.bind(null,e.data.input[0],0)})),React.createElement("div",{className:"arrow"}),React.createElement("div",{className:"output"},React.createElement(O,{data:e.data.output,showCount:e.showCount,offset:t,onClear:e.onClear&&e.onClear.bind(null,e.data.output,void 0),onClick:e.onClick&&e.onClick.bind(null,e.data.output,void 0)})))}function $(e){const[t,a]=React.useState(1),[n,i]=React.useState([]),[l,c]=React.useState([]),[r]=React.useContext(w);function o(e){i((t=>{const[a]=e.id,n=[...t];return n.splice(t.findIndex((e=>e===a)),1),n}))}React.useEffect((()=>{const e=Object.entries(r.lang).map((([e,t])=>({id:e,name:t})));c(e)}),[r.lang]),React.useEffect((()=>{i((()=>{var t;return(null==(t=e.value)?void 0:t.id)||[]})),a((()=>{var t;return(null==(t=e.value)?void 0:t.count)||1}))}),[e.visible]);const s=React.useMemo((()=>r.version.split(".")[1]),[r.version]);return React.createElement(antd.Modal,{className:"item-modal",okText:"确定",cancelText:"取消",title:"物品选择框",maskClosable:!1,width:690,onOk:function(){null==e||e.onOk({id:n,count:t}),null==e||e.onCancel()},onCancel:e.onCancel,visible:e.visible},React.createElement(antd.Row,{style:{marginBottom:16}},React.createElement(antd.Col,{span:4,style:{textAlign:"right",paddingRight:20,lineHeight:"30px"}},"物品"),React.createElement(antd.Col,{span:17},React.createElement(antd.Select,{showSearch:!0,allowClear:!0,mode:"multiple",value:n,tagRender:function(e){return React.createElement(O,{offset:0,onClear:o,data:{id:[e.value]}})},onChange:function(t){t.length>e.limit?antd.message.warning(`仅能选择 ${e.limit} 项`):i((()=>t))},style:{width:"100%"},filterOption:(e,{name:t,value:a})=>(a+t).includes(e),notFoundContent:"暂无内容",placeholder:"请选择，可搜索"},l.map((({id:e,name:t})=>React.createElement(antd.Select.Option,{key:e,value:e,name:t},React.createElement("div",{className:"select-item"},React.createElement("i",{className:`icon-${s} ${e}-${s}`}),React.createElement("span",null,t," - ",e)))))))),e.showCount?React.createElement(antd.Row,{style:{marginBottom:16}},React.createElement(antd.Col,{span:4,style:{textAlign:"right",paddingRight:20,lineHeight:"30px"}},"数量"),React.createElement(antd.Col,{span:17},React.createElement(antd.InputNumber,{step:1,max:64,min:1,style:{width:"100%"},value:t,onChange:e=>a((()=>e))}))):null)}const j={type:"crafting_shaped",input:[],output:{}};let A=new k,_={},L={};function U(t){const[a,n]=React.useContext(w),[i,l]=React.useState(!0),[c,r]=React.useState(!1),[o,s]=React.useState(j),[d,u]=React.useState(0),[h,R]=React.useState(""),[y,v]=React.useState(""),[E,C]=React.useState(void 0),[k,b]=React.useState(),[S,O]=React.useState(-1),[x,P]=React.useState(1),[U,I]=React.useState([]);function B(e){return a.tagZip.file(`items/${e}.json`).async("string").then((e=>JSON.parse(e).values.map((e=>({item:e})))))}function Z(e){if(!e)return antd.message.warn("请输入数据！"),Promise.reject();try{return function(e){var t;return(null==(t=e.ingredients)?void 0:t.length)?Promise.all(e.ingredients.map((e=>e.tag?B(p(e.tag)).then((e=>e)):e))).then((t=>(e.ingredients=t,e))):e.key?Promise.all(Object.keys(e.key).map((t=>{const a=e.key[t].tag;return a?B(p(a)).then((e=>({[t]:e}))):{[t]:e.key[t]}}))).then((t=>(e.key=Object.assign({},...t),e))):Promise.resolve(e)}(JSON.parse(e)).then((e=>{A.import(e),M()}))}catch(t){return""!==e&&(antd.message.warning("解析失败"),console.log(t)),s((()=>j)),Promise.reject()}}function M(){s((()=>A.data)),b((()=>{})),u((()=>0))}React.useEffect((()=>{n({type:"UpdateLoading",payload:!0}),m("./assets/default.json").then((e=>{L=e.cookingtime,_=e.experience})).catch((()=>{antd.message.error("资源加载失败")})).finally((()=>{n({type:"UpdateLoading",payload:!1})}))}),[]),React.useEffect((()=>{n({type:"UpdateLoading",payload:!0}),m(`https://unpkg.com/@wikijs/mc-recipes@1.0.5/dist/${a.version}.json`).then((e=>{I(e)})).catch((()=>{antd.message.error("资源加载失败")})).finally((()=>{n({type:"UpdateLoading",payload:!1})}))}),[a.version]);const T=React.useMemo((()=>f(o.type)===e.Other),[o.type]),H=React.useMemo((()=>a.version.split(".")[1]),[a.version]);return React.createElement("div",null,React.createElement(N,{showCount:i,data:o,onClick:function(t,a){O((()=>void 0===a?1:1/0)),u((()=>a)),b((()=>t)),l((()=>void 0===a&&f(A.getProps("type"))!==e.Other)),r((()=>!0))},onClear:function(e,t){if(void 0===t)A.setProps({result:{item:void 0,count:0}});else{const e=A.getProps("ingredients");e[t]={item:[]},A.setProps({ingredients:e})}M()}}),React.createElement($,{limit:S,showCount:i,value:k,visible:c,onCancel:()=>r(!1),onOk:function(e){if(void 0===d)A.setProps({result:{item:e.id[0],count:e.count}});else{d||function(e){const t=A.getProps("type");["blasting","smoking","smelting","campfire_cooking"].includes(t)&&A.setProps({cookingtime:L[t]}),A.setProps({experience:_[e.id[0]]})}(e);const t=A.getProps("ingredients");t[d]={item:e.id},A.setProps({ingredients:t})}M()}}),React.createElement(antd.Row,{style:{marginBottom:16}},React.createElement(antd.Col,{span:4,style:{textAlign:"right",paddingRight:8,lineHeight:"30px"}},React.createElement("span",null,"type"),React.createElement(antd.Tooltip,{title:"配方类型"},React.createElement(icons.InfoCircleOutlined,{style:{color:"#aaa",paddingLeft:4,verticalAlign:"middle"}}))),React.createElement(antd.Col,{span:16},React.createElement(antd.Select,{style:{width:"100%"},onChange:function(t){A.setProps({type:t}),l((()=>f(A.getProps("type"))!==e.Other)),M()},value:o.type,defaultValue:"crafting_shaped",placeholder:"请选择"},Object.keys(g).filter((e=>!g[e].disabled.includes(a.version))).map((e=>{const t=g[e].name;return React.createElement(antd.Select.Option,{key:e,value:e},React.createElement("div",{className:"select-item"},React.createElement("i",{className:`icon-${H} ${g[e].icon}-${H}`}),React.createElement("span",null,t," - ",e)))}))))),React.createElement(antd.Row,{style:{marginBottom:`${T?"16px":0}`}},React.createElement(antd.Col,{span:4,style:{textAlign:"right",paddingRight:8,lineHeight:"30px"}},React.createElement("span",null,"group"),React.createElement(antd.Tooltip,{title:"分组标识"},React.createElement(icons.InfoCircleOutlined,{style:{color:"#aaa",paddingLeft:4,verticalAlign:"middle"}}))),React.createElement(antd.Col,{span:16},React.createElement(antd.Input,{allowClear:!0,value:o.group,onChange:function(e){A.setProps({group:e.target.value}),M()},placeholder:"选填，相同标识符的配方会在配方书中被显示为一组"}))),T?React.createElement(React.Fragment,null,React.createElement(antd.Row,{style:{marginBottom:16}},React.createElement(antd.Col,{span:4,style:{textAlign:"right",paddingRight:8,lineHeight:"30px"}},React.createElement("span",null,"cookingtime"),React.createElement(antd.Tooltip,{title:"烧炼时间，单位tick，20tick=1s"},React.createElement(icons.InfoCircleOutlined,{style:{color:"#aaa",paddingLeft:4,verticalAlign:"middle"}}))),React.createElement(antd.Col,{span:16},React.createElement(antd.InputNumber,{min:0,step:20,precision:0,value:o.cookingtime,onChange:function(e){A.setProps({cookingtime:e}),M()},style:{width:"100%"},placeholder:"请输入，单位tick"}))),React.createElement(antd.Row,null,React.createElement(antd.Col,{span:4,style:{textAlign:"right",paddingRight:8,lineHeight:"30px"}},React.createElement("span",null,"experience"),React.createElement(antd.Tooltip,{title:"经验值"},React.createElement(icons.InfoCircleOutlined,{style:{color:"#aaa",paddingLeft:4,verticalAlign:"middle"}}))),React.createElement(antd.Col,{span:16},React.createElement(antd.InputNumber,{min:0,step:.1,value:o.experience,onChange:function(e){A.setProps({experience:e}),M()},style:{width:"100%"},placeholder:"请输入"})))):null,React.createElement(antd.Row,null,React.createElement(antd.Col,{offset:4,span:16},React.createElement(antd.Divider,null))),React.createElement(antd.Row,{style:{marginBottom:16}},React.createElement(antd.Col,{span:4,style:{textAlign:"right",paddingRight:16,lineHeight:"30px"}},"导入"),React.createElement(antd.Col,{span:16},React.createElement(antd.Input.Group,{compact:!0},React.createElement(antd.Select,{value:x,onChange:e=>P(e),style:{width:"25%"}},React.createElement(antd.Select.Option,{value:1},"原版配方"),React.createElement(antd.Select.Option,{value:2},"自定义配方")),1===x?React.createElement(antd.Select,{value:E,showSearch:!0,filterOption:(e,t)=>(t.name+t.value).includes(e),optionLabelProp:"value",style:{width:"75%"},placeholder:"配方列表，请选择",onChange:function(e){C(e),n({type:"UpdateLoading",payload:!0}),a.recipeZip.file(`${e}.json`).async("string").then((e=>(R(e),Z(e)))).finally((()=>{n({type:"UpdateLoading",payload:!1})}))}},U.map((e=>React.createElement(antd.Select.Option,{key:e.file,name:a.lang[e.id],value:e.file},React.createElement("div",{className:"select-item"},React.createElement("i",{className:`icon-${H} ${e.id}-${H}`}),React.createElement("span",null,a.lang[e.id]," - ",e.id),React.createElement("i",{className:`crafing icon-${H} ${g[e.type].icon}-${H}`})))))):React.createElement(antd.Input.Search,{style:{width:"75%"},placeholder:"请输入",enterButton:"解析",value:h,onChange:e=>R(e.target.value),onSearch:Z})))),React.createElement(antd.Row,{style:{marginBottom:16}},React.createElement(antd.Col,{span:4,style:{textAlign:"right",paddingRight:16,lineHeight:"30px"}},"文件名"),React.createElement(antd.Col,{span:16},React.createElement(antd.Input.Search,{placeholder:"请输入，缺省时复制到剪贴板",value:y,onChange:e=>v(e.target.value),onSearch:function(e){const t=JSON.stringify(A.toJson(),null,2);if(e){if(!/^[a-zA-Z\\$_][a-zA-Z\d_]*$/.test(e))return void antd.message.success("请输入合法的文件名");!function(e,t){const a=document.createElement("a");a.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(t)),a.setAttribute("download",e),a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a)}(e+".json",t)}else navigator.clipboard.writeText(t),antd.message.success("已复制到剪贴板")},enterButton:"导出"}))),React.createElement(antd.Row,{style:{marginBottom:16}},React.createElement(antd.Col,{span:4,style:{textAlign:"right",paddingRight:16,lineHeight:"30px"}},"操作"),React.createElement(antd.Col,{span:16},React.createElement(antd.Button,{style:{marginRight:8},onClick:function(){R(""),v(""),C(void 0),A.reset(),M()},type:"primary"},"重置"))))}function I(){const[e,t]=React.useReducer(S,b);return React.useEffect((()=>{t({type:"UpdateLoading",payload:!0}),m(`https://unpkg.com/@wikijs/mc-recipes/dist/langs/${e.version}.json`).then((e=>{t({type:"UpdateLang",payload:e})})).finally((()=>{t({type:"UpdateLoading",payload:!1})}))}),[e.version]),React.useEffect((()=>{Promise.all([fetch(`https://unpkg.com/@wikijs/mc-recipes/dist/recipes/${e.version}.zip`).then((e=>e.arrayBuffer())).then((e=>JSZip.loadAsync(e))),fetch(`https://unpkg.com/@wikijs/mc-tags/dist/${e.version}.zip`).then((e=>e.arrayBuffer())).then((e=>JSZip.loadAsync(e)))]).then((([e,a])=>{t({type:"UpdateRecipeZip",payload:e}),t({type:"UpdateTagZip",payload:a})})).catch((()=>{antd.message.error("资源加载失败")})).finally((()=>{t({type:"UpdateLoading",payload:!1})}))}),[e.version]),React.createElement(w.Provider,{value:[e,t]},React.createElement(antd.Spin,{spinning:e.loading},React.createElement("div",{className:"App"},React.createElement("div",{className:"header"},React.createElement("h1",null,"MC Recipe Editor"),React.createElement("div",{className:"right"},React.createElement(antd.Select,{value:e.version,onChange:e=>{t({type:"UpdateVersion",payload:e})},bordered:!1,style:{width:80,color:"#fff"}},e.versionList.map((e=>React.createElement(antd.Select.Option,{key:e,value:e},"v",e)))),React.createElement("a",{href:"https://github.com/hans000/mc-recipe-editor/issues",target:"_blank"},"问题反馈"))),React.createElement(U,null),React.createElement("div",{className:"footer"},React.createElement("span",null,"by "),React.createElement("a",{href:"https://github.com/hans000/mc-recipe-editor",target:"_blank"},"hans000"),React.createElement("span",{style:{padding:8}},"交流群916625813")))))}ReactDOM.render(React.createElement(I,null),document.getElementById("root"));
